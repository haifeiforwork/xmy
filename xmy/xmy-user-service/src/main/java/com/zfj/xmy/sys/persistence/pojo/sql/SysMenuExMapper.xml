<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="com.zfj.xmy.sys.persistence.dao.SysMenuExMapper" >
	<resultMap id="BaseResultMap" type="com.zfj.xmy.common.persistence.pojo.SysMenu" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="parent_id" property="parentId" jdbcType="BIGINT" />
    <result column="sn" property="sn" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="des" property="des" jdbcType="VARCHAR" />
    <result column="target_url" property="targetUrl" jdbcType="VARCHAR" />
    <result column="icon_url" property="iconUrl" jdbcType="VARCHAR" />
    <result column="seq" property="seq" jdbcType="INTEGER" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="creator" property="creator" jdbcType="VARCHAR" />
    <result column="updator" property="updator" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <!-- 根据用户查询相应的菜单 -->
  <select id="findMenuByUserId" parameterType="com.appdev.db.common.CriteriaParameter" resultMap="BaseResultMap">
        select distinct sm.* from (select role.*,srm.sys_menu_id menuid from (select su.*,sur.role_id rid from sys_user su LEFT JOIN sys_user_role sur on su.id=sur.user_id ) 
        role LEFT JOIN sys_role_menu srm on role.rid=srm.role_id) menu INNER JOIN sys_menu sm on menu.menuid=sm.id  <if test="_parameter != null" >
	     <include refid="sqlcriteria.util.Example_Where_Clause" />
		</if>
	</select>
</mapper>