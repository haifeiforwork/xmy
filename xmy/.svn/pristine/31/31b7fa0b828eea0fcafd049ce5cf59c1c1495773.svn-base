package com.zfj.xmy.cms.web.common;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStream;
import java.util.List;
import java.util.Map;

import javax.servlet.ServletOutputStream;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFCellStyle;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.HorizontalAlignment;
import org.apache.poi.ss.usermodel.IndexedColors;
import org.apache.poi.ss.util.CellRangeAddress;
import org.springframework.util.ObjectUtils;

import com.zfj.base.util.web.WebUtil;
import com.zfj.xmy.common.persistence.pojo.Order;
import com.zfj.xmy.common.persistence.pojo.OrderGoods;
import com.zfj.xmy.order.persistence.common.pojo.dto.LableDto;
import com.zfj.xmy.order.persistence.common.pojo.dto.OrderDto;
import com.zfj.xmy.order.persistence.common.pojo.dto.OrderGoodsDto;
import com.zfj.xmy.order.persistence.common.pojo.dto.ShoppingDto;

public class PoiUtil {
	/**
	 * 生成采购清单
	 * @param dto
	 * @param url void
	 * @author lij
	 * @date 2017年10月16日 下午3:41:50
	 */
	public void createShoppingList(List<OrderGoodsDto> dto,String url,HttpServletResponse response,List<OrderDto> orderDto){
		response.setCharacterEncoding("utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=shoping.xls ");
		 // 第一步，创建一个webbook，对应一个Excel文件  
        HSSFWorkbook wb = new HSSFWorkbook();  
        // 第二步，在webbook中添加一个sheet,对应Excel文件中的sheet  
        HSSFSheet sheet = wb.createSheet("采购清单");  
        // 第三步，在sheet中添加表头第0行,注意老版本poi对Excel的行数列数有限制short  
        HSSFRow row = sheet.createRow((int) 0);  
        // 第四步，创建单元格，并设置值表头 设置表头居中  
        HSSFCellStyle style = wb.createCellStyle();
        HSSFCellStyle style1 = wb.createCellStyle();
        
        style1.setAlignment(HorizontalAlignment.CENTER); // 创建一个居中格式  
        style.setAlignment(HorizontalAlignment.RIGHT);
        style.setFillBackgroundColor(IndexedColors.GREY_50_PERCENT.getIndex());
        //style1.setFillBackgroundColor((short)Color.blue.getBlue());
        CellRangeAddress cra = new CellRangeAddress(0, 0, 0, 10);
        HSSFCell cell = row.createCell((short) 0);  
        sheet.addMergedRegion(cra);
        cell.setCellValue("采购总表");
        cell.setCellStyle(style1);
        HSSFRow row1 = sheet.createRow((int) 1);
        cell=row1.createCell(0);
        cell.setCellValue("序号");
        cell=row1.createCell(1);
        cell.setCellValue("商品编号");
        cell=row1.createCell(2);
        cell.setCellValue("商品名称");
        cell=row1.createCell(3);
        cell.setCellValue("数量");
        cell=row1.createCell(4);
        cell.setCellValue("单位");
        cell=row1.createCell(5);
        cell.setCellValue("成本价");
        cell=row1.createCell(6);
        cell.setCellValue("销售价");
        cell=row1.createCell(7);
        cell.setCellValue("市场价");
        cell=row1.createCell(8);
        cell.setCellValue("供应商");
        cell=row1.createCell(9);
        cell.setCellValue("备注");
        cell=row1.createCell(10);
        cell.setCellValue("称编码");
        int j=2;
        int i=1;
        for (OrderGoodsDto goodsDto : dto) {
			row=sheet.createRow(j);
			row.setRowStyle(style1);
			//放入数据
			/*row.createCell(0).setCellValue(student.getId());
			row.createCell(1).setCellValue(student.getName());
			row.createCell(2).setCellValue(student.getAge());*/
			row.createCell(0).setCellValue(i);
			row.createCell(1).setCellValue(goodsDto.getCode());
			row.createCell(2).setCellValue(goodsDto.getName());
			row.createCell(3).setCellValue(goodsDto.getSumGoodsNum());//销售总数
			row.createCell(4).setCellValue(goodsDto.getUnitName());
			row.createCell(5).setCellValue(goodsDto.getCostPrice().toString());//成本价
			row.createCell(6).setCellValue(goodsDto.getPrice().toString());//销售价
			row.createCell(7).setCellValue(goodsDto.getMarketPrice().toString());//市场价
			row.createCell(8).setCellValue(goodsDto.getSupplierName());//供货商名称
			row.createCell(9).setCellValue(goodsDto.getRemarkNum());//备注
			row.createCell(10).setCellValue("暂无该字段");//陈编码
			row1=sheet.createRow(j+1);
			HSSFCell createCell = row1.createCell(0);
			//商品编码
			//createCell.setCellValue(student.getName());
			String str="";
			List<ShoppingDto> getsDto = goodsDto.getsDto();
			for (ShoppingDto shoppingDto : getsDto) {
				str+="编码:"+shoppingDto.getNo()+"数量:"+shoppingDto.getNum();
			}
			createCell.setCellValue(str);
			createCell.setCellStyle(style);
		/*	sheet.addMergedRegion(new Region((short)i+3,(short)0,(short)i+3 
            		,(short)10));//合并从第rowFrom行columnFrom列  )
*/			
			sheet.addMergedRegion(new CellRangeAddress(j+1, j+1, 0, 10));
			j+=2;
			i++;
		}
        CellRangeAddress orderTileText= new CellRangeAddress(j, j, 0, 15);
        HSSFRow orderTitle = sheet.createRow(j);
        sheet.addMergedRegion(orderTileText);
        orderTitle.createCell(0).setCellValue("订单商品详细");
        orderTitle.getCell(0).setCellStyle(style1);
        j++;
        HSSFRow orderTile = sheet.createRow(j);
        orderTile.createCell(0).setCellValue("订单编号");
        orderTile.createCell(1).setCellValue("商品编码");
        orderTile.createCell(2).setCellValue("商品名称");
        orderTile.createCell(3).setCellValue("数量");
        orderTile.createCell(4).setCellValue("单位");
        orderTile.createCell(5).setCellValue("成本价");
        orderTile.createCell(6).setCellValue("");
        orderTile.createCell(7).setCellValue("销售价");
        orderTile.createCell(8).setCellValue("");
        orderTile.createCell(9).setCellValue("活动价");
        orderTile.createCell(10).setCellValue("市场价");
        orderTile.createCell(11).setCellValue("供应商");
        orderTile.createCell(12).setCellValue("客户电话");
        orderTile.createCell(13).setCellValue("客户名称");
        orderTile.createCell(14).setCellValue("称编码");
        j++;
        for (OrderDto order : orderDto) {
        	int size=order.getGoodsList().size()-1;
    		if(size>=0){
    			HSSFRow dataRow = sheet.createRow(j);
    			dataRow.createCell(0).setCellValue(order.getNo());
    			dataRow.createCell(12).setCellValue(order.getConsigneePhone());
    			dataRow.createCell(13).setCellValue(order.getConsigneeName());
    			List<OrderGoodsDto> goodsList = order.getGoodsList();
    			for (OrderGoodsDto goods : goodsList) {
    				HSSFRow goodsRow = sheet.getRow(j);
    				if(ObjectUtils.isEmpty(goodsRow)){
    					goodsRow = sheet.createRow(j);
    				}
    				goodsRow.createCell(1).setCellValue(goods.getCode());
    				goodsRow.createCell(2).setCellValue(goods.getName());
    				goodsRow.createCell(3).setCellValue(goods.getSumGoodsNum());
    				goodsRow.createCell(4).setCellValue(goods.getUnitName());
    				goodsRow.createCell(5).setCellValue(goods.getCostPrice().toString());
    				goodsRow.createCell(6).setCellValue(goods.getCostPrice().toString());
    				goodsRow.createCell(7).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(8).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(9).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(10).setCellValue(goods.getMarketPrice().toString());
    				goodsRow.createCell(11).setCellValue(goods.getSupplierName());
    				goodsRow.createCell(14).setCellValue("无");
    				j++;
    			}
    			int c= j;
    			if(size>0){
    				CellRangeAddress zior = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 0, 0);
    				CellRangeAddress zior1 = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 12, 12);
    				CellRangeAddress zior2 = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 13, 13);
    				sheet.addMergedRegion(zior);
    				sheet.addMergedRegion(zior1);
    				sheet.addMergedRegion(zior2);
    			}
    		}
        	//j++;
		}
        
        // 第六步，将文件存到指定位置  
        try  
        {  
        	//写入文件本地地址url
            //FileOutputStream fout = new FileOutputStream(url);  
            ServletOutputStream fout = response.getOutputStream();
            wb.write(fout);  
            fout.close();  
        }  
        catch (Exception e)  
        {  
            e.printStackTrace();  
        }  
	}
	/**
	 * @param type void
	 * @author lij
	 * @date 2017年10月18日 上午10:10:02
	 */
	public void createShoppingCart(Integer type,String fileName,List<OrderGoodsDto> goodsDto,List<OrderDto> orderDto,HttpServletResponse response){
		response.setCharacterEncoding("utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=order.xls "); 
		// 第一步，创建一个webbook，对应一个Excel文件  
        HSSFWorkbook wb = new HSSFWorkbook();  
        // 第二步，在webbook中添加一个sheet,对应Excel文件中的sheet  
        HSSFSheet sheet = wb.createSheet("shoppingList");  
        HSSFCellStyle titleStyle = wb.createCellStyle();
        titleStyle.setAlignment(HorizontalAlignment.CENTER);
        // 第三步，在sheet中添加表头第0行,注意老版本poi对Excel的行数列数有限制short  
        HSSFRow rowTitle = sheet.createRow((int) 0);
        CellRangeAddress title = new CellRangeAddress(0, 0, 0, 14);
        if(type==1){
        	rowTitle.createCell(0).setCellValue("香满园----西部农产品电子商务平台  农配中心");
        }
        if(type==0){
        	rowTitle.createCell(0).setCellValue("香满园----西部农产品电子商务平台  水果市场");
        }
        rowTitle.getCell(0).setCellStyle(titleStyle);
        sheet.addMergedRegion(title);
        HSSFRow fuTile = sheet.createRow(1);
        CellRangeAddress fuTiles= new CellRangeAddress(1, 1, 0, 14);
        fuTile.createCell(0).setCellValue("采购总表");
        fuTile.getCell(0).setCellStyle(titleStyle);
        sheet.addMergedRegion(fuTiles);
        HSSFRow biaoti = sheet.createRow(2);
        biaoti.createCell(0).setCellValue("序号");
        biaoti.createCell(1).setCellValue("商品编码");
        biaoti.createCell(2).setCellValue("商品名称");
        biaoti.createCell(3).setCellValue("数量");
        biaoti.createCell(4).setCellValue("单位");
        biaoti.createCell(5).setCellValue("成本价");
        biaoti.createCell(6).setCellValue("");
        biaoti.createCell(7).setCellValue("销售价");
        biaoti.createCell(8).setCellValue("");
        biaoti.createCell(9).setCellValue("活动价");
        biaoti.createCell(10).setCellValue("市场价");
        biaoti.createCell(11).setCellValue("供应商");
        biaoti.createCell(12).setCellValue("备注");
        biaoti.createCell(13).setCellValue("称编码");
        //遍历数据
        int j=3;
        /*for(int i=3;i<=13;i++){
        	HSSFRow dataRow = sheet.createRow(i);
        	dataRow.createCell(0).setCellValue("1");
        	dataRow.createCell(1).setCellValue("2");
        	j++;
        }*/
        int i=0;//表示序号
        for (OrderGoodsDto goods : goodsDto) {
        	HSSFRow dataRow = sheet.createRow(j);
        	dataRow.createCell(0).setCellValue(i);
        	dataRow.createCell(1).setCellValue(goods.getCode());
        	dataRow.createCell(2).setCellValue(goods.getName());
        	dataRow.createCell(3).setCellValue(goods.getSumGoodsNum());
        	dataRow.createCell(4).setCellValue(goods.getUnitName());
        	dataRow.createCell(5).setCellValue(goods.getCostPrice().toString());
        	dataRow.createCell(6).setCellValue(goods.getCostPrice().toString());
        	dataRow.createCell(7).setCellValue(goods.getPrice().toString());
        	dataRow.createCell(8).setCellValue(goods.getPrice().toString());
        	dataRow.createCell(9).setCellValue(goods.getPrice().toString());
        	dataRow.createCell(10).setCellValue(goods.getMarketPrice().toString());
        	dataRow.createCell(11).setCellValue(goods.getSupplierName());
        	dataRow.createCell(12).setCellValue(goods.getRemarkNum());
        	dataRow.createCell(13).setCellValue("无");
        	j++;
        	i++;
		}
        CellRangeAddress orderTileText= new CellRangeAddress(j, j, 0, 15);
        HSSFRow orderTitle = sheet.createRow(j);
        sheet.addMergedRegion(orderTileText);
        orderTitle.createCell(0).setCellValue("订单商品详细");
        orderTitle.getCell(0).setCellStyle(titleStyle);
        j++;
        HSSFRow orderTile = sheet.createRow(j);
        orderTile.createCell(0).setCellValue("订单编号");
        orderTile.createCell(1).setCellValue("商品编码");
        orderTile.createCell(2).setCellValue("商品名称");
        orderTile.createCell(3).setCellValue("数量");
        orderTile.createCell(4).setCellValue("单位");
        orderTile.createCell(5).setCellValue("成本价");
        orderTile.createCell(6).setCellValue("");
        orderTile.createCell(7).setCellValue("销售价");
        orderTile.createCell(8).setCellValue("");
        orderTile.createCell(9).setCellValue("活动价");
        orderTile.createCell(10).setCellValue("市场价");
        orderTile.createCell(11).setCellValue("供应商");
        orderTile.createCell(12).setCellValue("客户电话");
        orderTile.createCell(13).setCellValue("客户名称");
        orderTile.createCell(14).setCellValue("称编码");
        j++;
        for (OrderDto order : orderDto) {
        	int size=order.getGoodsList().size()-1;
    		if(size>=0){
    			HSSFRow dataRow = sheet.createRow(j);
    			dataRow.createCell(0).setCellValue(order.getNo());
    			dataRow.createCell(12).setCellValue(order.getConsigneePhone());
    			dataRow.createCell(13).setCellValue(order.getConsigneeName());
    			List<OrderGoodsDto> goodsList = order.getGoodsList();
    			for (OrderGoodsDto goods : goodsList) {
    				HSSFRow goodsRow = sheet.getRow(j);
    				if(ObjectUtils.isEmpty(goodsRow)){
    					goodsRow = sheet.createRow(j);
    				}
    				goodsRow.createCell(1).setCellValue(goods.getCode());
    				goodsRow.createCell(2).setCellValue(goods.getName());
    				goodsRow.createCell(3).setCellValue(goods.getSumGoodsNum());
    				goodsRow.createCell(4).setCellValue(goods.getUnitName());
    				goodsRow.createCell(5).setCellValue(goods.getCostPrice().toString());
    				goodsRow.createCell(6).setCellValue(goods.getCostPrice().toString());
    				goodsRow.createCell(7).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(8).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(9).setCellValue(goods.getPrice().toString());
    				goodsRow.createCell(10).setCellValue(goods.getMarketPrice().toString());
    				goodsRow.createCell(11).setCellValue(goods.getSupplierName());
    				goodsRow.createCell(14).setCellValue("无");
    				j++;
    			}
    			int c= j;
    			if(size>0){
    				CellRangeAddress zior = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 0, 0);
    				CellRangeAddress zior1 = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 12, 12);
    				CellRangeAddress zior2 = new CellRangeAddress(c-(order.getGoodsList().size()), c-1, 13, 13);
    				sheet.addMergedRegion(zior);
    				sheet.addMergedRegion(zior1);
    				sheet.addMergedRegion(zior2);
    			}
    		}
        	//j++;
		}
       /* for(int k=j;k<=j+6;k++){
        	HSSFRow dataRow = sheet.createRow(k);
        	dataRow.createCell(0).setCellValue("1");
        	dataRow.createCell(1).setCellValue("2");
        	k+=2;
        	CellRangeAddress zior = new CellRangeAddress(k-2, k, 0, 0);
        	CellRangeAddress zior1 = new CellRangeAddress(k-2, k, 12, 12);
        	CellRangeAddress zior2 = new CellRangeAddress(k-2, k, 13, 13);
        	sheet.addMergedRegion(zior);
        	sheet.addMergedRegion(zior1);
        	sheet.addMergedRegion(zior2);
        }*/
        try {
			/*List<Student> student = getStudent();
			for (Student stu : student) {
				HSSFRow dataRow = sheet.createRow(j);
	        	dataRow.createCell(0).setCellValue(stu.getName());
	        	dataRow.createCell(1).setCellValue(stu.getName());
	        	j+=(stu.getAge()-1);
	        	int c= j;
	        	CellRangeAddress zior = new CellRangeAddress(c-(stu.getAge()-1), c, 0, 0);
	        	CellRangeAddress zior1 = new CellRangeAddress(c-(stu.getAge()-1), c, 12, 12);
	        	CellRangeAddress zior2 = new CellRangeAddress(c-(stu.getAge()-1), c, 13, 13);
	        	sheet.addMergedRegion(zior);
	        	sheet.addMergedRegion(zior1);
	        	sheet.addMergedRegion(zior2);
	        	j++;
			}*/
		} catch (Exception e1) {
			// TODO Auto-generated catch block
			e1.printStackTrace();
		}
        try  
        {  
            ServletOutputStream fout = response.getOutputStream();
            wb.write(fout);  
            fout.close();  
        }  
        catch (Exception e)  
        {  
            e.printStackTrace();  
        }  
	}
	/**
	 * 导出标签
	 *  void
	 * @author lij
	 * @throws Exception 
	 * @date 2017年10月18日 下午3:49:54
	 */
	public void exlLable(List<LableDto> lableDto,HttpServletResponse response) throws Exception{
		response.setCharacterEncoding("utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=lable.xls ");
		HttpServletRequest request = WebUtil.getRequest();
		String path = request.getServletContext().getRealPath("")+"/model/sss.xls";
		InputStream in = new FileInputStream(new File(path));
		 // 第一步，创建一个webbook，对应一个Excel文件  
        HSSFWorkbook wb = new HSSFWorkbook(in);  
        // 第二步，在webbook中添加一个sheet,对应Excel文件中的sheet  
        HSSFSheet sheet = wb.getSheetAt(0);
        // 第三步，在sheet中添加表头第0行,注意老版本poi对Excel的行数列数有限制short  
        int i=0;
        for (LableDto lable : lableDto) {
			String str = lable.getName()+"\n"+lable.getCode()+"\n"+lable.getNo();
        	HSSFRow dataRow = sheet.getRow(i);
			int j=lable.getNum();
			for(int k=0;k<j;k++){
				if(ObjectUtils.isEmpty(dataRow.getCell(k))){
					dataRow.createCell(k).setCellValue(str);
				}else{
					dataRow.getCell(k).setCellValue(str);
				}
				//dataRow.getCell(k).setCellStyle(style);
			}
        	i++;
		}
        // 第六步，将文件存到指定位置  
        try  
        {  
        	//写入文件本地地址url
            //FileOutputStream fout = new FileOutputStream(url);  
            ServletOutputStream fout = response.getOutputStream();
            wb.write(fout);  
            fout.close();  
        }  
        catch (Exception e)  
        {  
            e.printStackTrace();  
        }  
	}
	
	/**
	 * 导出白标签
	 *  void
	 * @author lij
	 * @throws Exception 
	 * @date 2017年10月18日 下午3:49:54
	 */
	public void exlWhriteLable(List<Order> orderList,HttpServletResponse response) throws Exception{
		response.setCharacterEncoding("utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=WhriteLable.xls ");
		HttpServletRequest request = WebUtil.getRequest();
		String path = request.getServletContext().getRealPath("")+"/model/whirte.xls";
		InputStream in = new FileInputStream(new File(path));
		 // 第一步，创建一个webbook，对应一个Excel文件  
        HSSFWorkbook wb = new HSSFWorkbook(in);  
        // 第二步，在webbook中添加一个sheet,对应Excel文件中的sheet  
        HSSFSheet sheet = wb.getSheetAt(0);
        // 第三步，在sheet中添加表头第0行,注意老版本poi对Excel的行数列数有限制short  
        int i = 0;
        int j = 0;
    	for (Order order : orderList) {
			HSSFRow row = sheet.getRow(i);
			row.getCell(j).setCellValue(order.getNo());
			HSSFRow row2 = sheet.getRow(i+1);
			row2.getCell(j).setCellValue("          "+order.getConsigneeName()+"      "+order.getConsigneePhone());
			HSSFRow row3 = sheet.getRow(i+2);
			row3.getCell(j).setCellValue(order.getConsigneeAddress());
//			HSSFRow row4 = sheet.getRow(i+3);
//			row4.getCell(j).setCellValue(order.getBusinessRemark());
			if(j==0){
				j=1;
			}else{
				j=0;i+=3;
			}
		}
        /*for (LableDto lable : lableDto) {
			String str = lable.getName()+"\n"+lable.getCode()+"\n"+lable.getNo();
        	HSSFRow dataRow = sheet.getRow(i);
			int j=lable.getNum();
			for(int k=0;k<j;k++){
				if(ObjectUtils.isEmpty(dataRow.getCell(k))){
					dataRow.createCell(k).setCellValue(str);
				}else{
					dataRow.getCell(k).setCellValue(str);
				}
				//dataRow.getCell(k).setCellStyle(style);
			}
        	i++;
		}*/
        // 第六步，将文件存到指定位置  
        try  
        {  
        	//写入文件本地地址url
            //FileOutputStream fout = new FileOutputStream(url);  
            ServletOutputStream fout = response.getOutputStream();
            wb.write(fout);  
            fout.close();  
        }  
        catch (Exception e)  
        {  
            e.printStackTrace();  
        }  
	}
	/**
	 * 导出客户清单
	 * @param map
	 * @param response void
	 * @author lij
	 * @throws Exception 
	 * @date 2017年11月13日 上午9:46:14
	 */
	public void exlWithUserList(Map<String, Object> map,HttpServletResponse response) throws Exception{
		response.setCharacterEncoding("utf-8");
		response.setHeader("Content-Disposition", "attachment; filename=userList.xls ");
		HttpServletRequest request = WebUtil.getRequest();
		String path = request.getServletContext().getRealPath("")+"/model/users.xls";
		InputStream in = new FileInputStream(new File(path));
		 // 第一步，创建一个webbook，对应一个Excel文件  
        HSSFWorkbook wb = new HSSFWorkbook(in);
        // 第二步，在webbook中添加一个sheet,对应Excel文件中的sheet  
        HSSFSheet sheet = wb.getSheetAt(0);
        
        //1.写入订单信息
        Order order = (Order) map.get("order");
        sheet.getRow(2).getCell(9).setCellValue(order.getCreateTime());
        sheet.getRow(3).getCell(0).setCellValue(order.getNo());
        sheet.getRow(3).getCell(5).setCellValue(order.getConsigneeName());
        sheet.getRow(3).getCell(8).setCellValue(order.getConsigneePhone());
        sheet.getRow(4).getCell(0).setCellValue(order.getConsigneeAddress());
        sheet.getRow(17).getCell(3).setCellValue(order.getFreight().toString());
        sheet.getRow(17).getCell(5).setCellValue("-"+order.getFreight().toString());
        sheet.getRow(17).getCell(7).setCellValue(order.getTotal().toString());
        sheet.getRow(17).getCell(9).setCellValue(order.getFreight().toString());
        sheet.getRow(17).getCell(11).setCellValue(0);
        sheet.getRow(18).getCell(6).setCellValue(order.getTotal().toString());
        sheet.getRow(18).getCell(9).setCellValue("提货卡："+order.getTotal().toString());
        wb.setSheetName(0, order.getNo()+"-1");
        //2.写入订单商品信息
        List<OrderGoods> goodsList = (List<OrderGoods>) map.get("goods");
        int size = goodsList.size();
        HSSFSheet sheet2 =null; 
        if(size>10){
        	sheet2 = wb.cloneSheet(0);
        }
        //2.1订单商品大于10个的时候
        //goodsList.size()>10;
        int i = 7;
        int j = 1;
        for (OrderGoods orderGoods : goodsList) {
        	sheet.getRow(i).getCell(0).setCellValue(j);
        	sheet.getRow(i).getCell(1).setCellValue(orderGoods.getNo().toString());
        	sheet.getRow(i).getCell(2).setCellValue(orderGoods.getName());
        	sheet.getRow(i).getCell(10).setCellValue(orderGoods.getNum()+"/件");
        	sheet.getRow(i).getCell(11).setCellValue(orderGoods.getPrice().toString());
        	sheet.getRow(i).getCell(12).setCellValue(orderGoods.getSumPrice().toString());
        	j++;
        	i++;
        	if(i>16){
        		break;
        	}
		}
        if(size>10){
	       	sheet2.getRow(2).getCell(9).setCellValue(order.getCreateTime());
	       	sheet2.getRow(3).getCell(0).setCellValue(order.getNo());
	       	sheet2.getRow(3).getCell(5).setCellValue(order.getConsigneeName());
	       	sheet2.getRow(3).getCell(8).setCellValue(order.getConsigneePhone());
	       	sheet2.getRow(4).getCell(0).setCellValue(order.getConsigneeAddress());
	       	sheet2.getRow(17).getCell(3).setCellValue(order.getFreight().toString());
	       	sheet2.getRow(17).getCell(5).setCellValue("-"+order.getFreight().toString());
	       	sheet2.getRow(17).getCell(7).setCellValue(order.getTotal().toString());
	       	sheet2.getRow(17).getCell(9).setCellValue(order.getFreight().toString());
	       	sheet2.getRow(17).getCell(11).setCellValue(0);
	       	sheet2.getRow(18).getCell(6).setCellValue(order.getTotal().toString());
	       	sheet2.getRow(18).getCell(9).setCellValue("提货卡："+order.getTotal().toString());
	       	wb.setSheetName(1, order.getNo()+"-2");
	       	int a=7;
	    	int b = 10;
	    	for(int q=10;q<goodsList.size();q++){
	    		sheet2.getRow(a).getCell(0).setCellValue(b);
	        	sheet2.getRow(a).getCell(1).setCellValue(goodsList.get(q).getNo().toString());
	        	sheet2.getRow(a).getCell(2).setCellValue(goodsList.get(q).getName());
	        	sheet2.getRow(a).getCell(10).setCellValue(goodsList.get(q).getNum()+"/件");
	        	sheet2.getRow(a).getCell(11).setCellValue(goodsList.get(q).getPrice().toString());
	        	sheet2.getRow(a).getCell(12).setCellValue(goodsList.get(q).getSumPrice().toString());
	        	a++;
	        	b++;
	    	}
       }
        
        // 第六步，将文件存到指定位置  
        try  
        {  
        	//写入文件本地地址url
            //FileOutputStream fout = new FileOutputStream(url);  
        	ServletOutputStream fout = response.getOutputStream();
    		wb.write(fout);  
    		fout.close();  
        }  
        catch (Exception e)  
        {  
            e.printStackTrace();  
        }  
		
		
	}
}
