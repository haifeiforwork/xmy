package com.zfj.xmy.cms.web.controller.activity;

import java.text.SimpleDateFormat;
import java.util.Date;

import javax.servlet.http.HttpServletRequest;

import org.apache.ibatis.annotations.Param;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.propertyeditors.CustomDateEditor;
import org.springframework.util.ObjectUtils;
import org.springframework.web.bind.ServletRequestDataBinder;
import org.springframework.web.bind.annotation.InitBinder;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.ModelAndView;

import com.appdev.db.common.pojo.PageBean;
import com.zfj.xmy.activity.service.cms.CmsOnlineService;
import com.zfj.xmy.cms.web.controller.BaseController;
import com.zfj.xmy.common.ReqData;
import com.zfj.xmy.common.persistence.pojo.OnlineActivity;

/**
 * 全场优惠活动控制层
 * @author Administrator
 *
 */
@RequestMapping("/onlineActivity")
@RestController
public class OnlieActivityController extends BaseController{
	
	@Autowired
	private CmsOnlineService cmsOnlineService;
	
	@InitBinder
	public void initBinder(HttpServletRequest request,
			ServletRequestDataBinder binder) throws Exception {

		binder.registerCustomEditor(Date.class, new CustomDateEditor(
				new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"), true));
	}
	/**
	 * 全场活动商品名称
	 * @param request
	 * @param reqData
	 * @return ModelAndView
	 * @author lij
	 * @date 2018年1月11日 下午2:41:19
	 */
	@RequestMapping("/list")
	public ModelAndView onLineAcitivtyList(HttpServletRequest request,ReqData reqData){
		reqData2Params(reqData);
		PageBean pageBean = new PageBean();
		cmsOnlineService.listActivity(reqData, pageBean);
		request.setAttribute("totalPage",pageBean.getTotalPage()) ;
		return new ModelAndView("/activity/onlineActivity/onlineActivity_list");
	}
	
	@RequestMapping("/list/{pageIndex}")
	public ModelAndView onLineActivityContent(@PathVariable("pageIndex") Integer pageIndex,HttpServletRequest request,ReqData reqData){
		PageBean pageBean = new PageBean();
		pageBean.setPageIndex(pageIndex);
		cmsOnlineService.listActivity(reqData, pageBean);;
		request.setAttribute("alist", pageBean.getData());
		return new ModelAndView("/activity/onlineActivity/onlineActivity_list_page");
	}
	/**
	 * 去修改页面
	 * @return ModelAndView
	 * @author lij
	 * @date 2018年1月11日 下午3:27:03
	 */
	@RequestMapping("updateActvity")
	public ModelAndView toUpdateActivity(@Param("id") Long id,HttpServletRequest request){
		OnlineActivity onlineActivityById = cmsOnlineService.getOnlineActivityById(id);
		request.setAttribute("data", onlineActivityById);
		return new ModelAndView("/activity/onlineActivity/edit_onlineActivity");
	}
	/**
	 * 修改或新增时的方法
	 * @param request
	 * @param onlineActivity
	 * @return ModelAndView
	 * @author lij
	 * @date 2018年1月11日 下午3:54:01
	 */
	@RequestMapping("addOnlineActivity")
	public ModelAndView addOnlineActivity(HttpServletRequest request,OnlineActivity onlineActivity){
		if(ObjectUtils.isEmpty(onlineActivity.getId())){
			cmsOnlineService.addOnlineActivity(onlineActivity);
		}else{
			cmsOnlineService.updateOnlineActivity(onlineActivity);
		}
		return new ModelAndView("redirect:/onlineActivity/list");
	}
}
